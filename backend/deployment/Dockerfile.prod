FROM python:3.8

WORKDIR /app

ENV PYTHONFAULTHANDLER=1 PYTHONUNBUFFERED=1 PIP_NO_CACHE_DIR=1

COPY requirements.txt .

RUN pip install -r requirements.txt

COPY mj mj
COPY events events
COPY scraping scraping
COPY manage.py .
COPY setup.py .
COPY deployment/serve.sh .

RUN pip install .

ENTRYPOINT ["/app/serve.sh"]

CMD ["gunicorn", "--bind", ":8000", "-k", "uvicorn.workers.UvicornWorker", "mj.asgi:application"]
